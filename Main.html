<div ng-app="app">
    <div ng-controller="GraphController">
        Enter a number:
        <input type="string" ng-model="ticker" />
        <button ng-click="getData()">Fetch Data</button>

        <div>Answer: {{answer}}</div>
    </div>


</div>
<div id="tester" style="width:100%;height:100%;"></div>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="jquery.js"></script>
<script>
var app = angular.module('app', []);

app.service('GraphService', function() {

  this.graph = function(data) {
    TESTER = document.getElementById('tester');

    Plotly.plot( TESTER, data );
  };

});


app.controller('GraphController', function($scope, GraphService) {

  $scope.getData = function(){
    $scope.graphData = [];
    $.ajax({url: "https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&interval=60min&outputsize=full&symbol=" + $scope.ticker + "&apikey=U2SWZSWXTDD7DV1D", success: function(result){
        console.log(result);
        //["Technical Analysis: SMA"]["2000-01-14"].SMA
        //var rawData = JSON.parse(result);
        //console.log(rawData);

        var data = {x: [], y: [], type: 'scatter'};
        data.name = 'Closing Price';

        Object.keys(result["Time Series (60min)"]).forEach(function (key) {
            //console.log(key);

            if(data.x.length > maxData * 24){
                return;
            }
            data.x.push(key);
            data.y.push(result["Time Series (60min)"][key]["4. close"]);
            // do something with obj[key]
        });

        $scope.graphData.push(data);
        console.log(data.x.length)
        GraphService.graph($scope.graphData);
    }});

  }

});

</script>
